
# Flink CEP
CEP는 이벤트 스트림에서 **패턴을 정의하고 추출**하는 라이브러리    
→ Pattern API로 패턴을 정의하고, 감지된 패턴에 대해 처리

### 순서
1. 입력 데이터 스트림 생성
2. CEP 패턴 정의
3. CEP 패턴을 입력 스트림에 적용
4. 패턴 스트림에서 감지된 패턴에 대해 선택된 요소 처리

```java
// 1. 입력 데이터 스트림 생성. CEP 패턴 감지를 위해 사용 (Event 타입)
DataStream<Event> input = ...;

// 2. CEP 패턴 정의
Pattern<Event, ?> pattern = Pattern.<Event>begin("start")
        .next("middle")
        .where(SimpleCondition.of(value -> value.getName().equals("error")))
        .followedBy("end")
        .where(SimpleCondition.of(value -> value.getName().equals("critical")))
        .within(Time.seconds(10));

// 3. 정의한 CEP 패턴을 입력 데이터 스트림에 적용. 패턴 스트림 생성
PatternStream<Event> patternStream = CEP.pattern(input, pattern);

// 4. 패턴 스트림에서 감지된 패턴에 대해 선택된 요소 처리
DataStream<Alert> alerts = patternStream.select(new PatternSelectFunction<Event, Alert>() {
    @Override
    public Alert select(Map<String, List<Event>> pattern) throws Exception {
        return createAlert(pattern);
    }
});
```
<BR>

## CEP 패턴 정의. Pattern API
- 입력 스트림에서 추출하려는 복잡한 패턴 시퀀스를 정의
- 특정 조건과 제약 조건을 갖는 이벤트의 시퀀스를 지정해서 패턴을 정의

### 패턴 정의 방법
1. 개별적으로 조건(condition)을 통해 패턴을 정의함
2. 개별 패턴을 조합해서 전체 패턴 시퀀스로 결합
```java
// CEP 패턴 정의
Pattern<Event, ?> pattern = Pattern.<Event>begin("start")
        .next("middle")
        .where(SimpleCondition.of(value -> value.getName().equals("error")))
        .followedBy("end")
        .where(SimpleCondition.of(value -> value.getName().equals("critical")))
        .within(Time.seconds(10));
```

### 조건을 정의하는 method
  
  
  
  
  
  
  


