---
layout: post
title: "message broker"
등록일: 2023-04-28
수정일: 2023-05-02
author: 이한솔
---

특징, 구조, 동작, 성능(속도, 부하, 어디까지 가능?)

요구사항 : 비동기 처리 가능할 것, 다양한 프로그래밍 언어 client가 있을 것, multiple producer-consumer 가능, 속도가 빠를 것    
→ 핵심은 성능 (속도, 부하).    
성능에 영향을 미치는 요소? 아키텍처와 동작 방법을 확인해 어떤 부분에서 문제가 발생할지 예상, 속도를 빠르게 하고 부하를 줄이기 위한 방법들    

---

## **Kafka**    
> kafka는 pub-sub(메시지를 받기를 원하는 consumer 해당 topic을 구독함으로써 메시지를 읽어옴)방식의 분산형 스트리밍 플랫폼    

<img src="https://user-images.githubusercontent.com/109563345/235531340-bc045761-0c29-4859-a993-0d5796f559c3.png" width="700">

### **동작**    
Topic을 기준으로 메시지를 관리.    
- Producer는 특정 Topic의 메시지를 생성한 뒤 해당 메시지를 Broker에 전달    
- Broker가 전달받은 메시지를 Topic별로 분류하여 쌓아놓으면, 해당 Topic을 구독하는 Consumer들이 메시지를 가져가서 처리    

  **<Topic과 Partition>**    
  하나의 Topic은 여러 Partition으로 구성. 분산 저장해서 시간을 단축시키기 위해        
  Partition안에서는 Offset단위로 나뉘어짐    
  ![image](https://user-images.githubusercontent.com/109563345/235552672-0dfc0d4c-d7c3-4c60-9701-bc2224f81a50.png)


### **특징**    
1. 시스템 확장이 쉽게 가능 (Broker 추가)    
2. 데이터 영속성 (데이터를 생성한 프로그램의 실행이 종료되더라도 사라지지 않음)     
데이터를 메모리에 저장하지 않고 디스크(파일)에 저장 → 메시지 유실 우려가 감소    
@@@@@@@그래도 빠른 이유@@@@@@@
3. 고가용성 (시스템의 장애가 발생하여도 중단 없이 정상 작동하도록 하는 것)
리플리케이션(메시지를 여러 개로 복제해서 카프카 클러스터 내 브로커들에게 분산) 기능을 통해 보장    
4. 성능이 좋음. 처리량이 높고, 속도가 빠름 (Kafka 는 왜 빠를까?)    
    1. zero copy
    2. page cache
    3. low-latency IO
    https://www.skyer9.pe.kr/wordpress/?p=3372    
    https://parkcheolu.tistory.com/261
    https://ksr930.tistory.com/160    
    https://ifuwanna.tistory.com/487    

5. Consumer가 Broker로부터 메시지를 직접 가져가는 PULL 방식으로 동작 → Consumer는 자신의 처리 능력만큼의 메시지만 가져와 최적의 성능    
6. 스트림 처리    
7. 순서 보장    
8. 데이터 유실 없도록    
9. Leader Partition과 Follower Partition의 역할 - ACK 옵션 <https://blossun.github.io/infra/kafka/02_%EC%B9%B4%ED%94%84%EC%B9%B4-%ED%95%B5%EC%8B%AC-%EC%9A%94%EC%86%8C-3%EA%B0%80%EC%A7%80/>    

---
참고    
<https://velog.io/@busybean3/%EC%95%84%ED%8C%8C%EC%B9%98-%EC%B9%B4%ED%94%84%EC%B9%B4Apache-Kafka-%EB%9E%80>
<https://velog.io/@cbkyeong/Kafka%ED%86%A0%ED%94%BD%EC%9D%B4%EB%9E%80>    
파티션을 무조건 늘리면 안되는 이유 <https://12bme.tistory.com/528>    

